name: Helm Chart CI
on: [pull_request]

jobs:
  lint-helm-3-x:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Helm install
      uses: Azure/setup-helm@v1

    - name: Lint 'KEDA' Helm chart
      run: helm lint keda

  deploy-helm-3-x:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Helm install
      uses: Azure/setup-helm@v1
      
    - name: Create k8s Kind Cluster
      uses: helm/kind-action@v1.0.0

    - name: Create keda-system namespace
      run: kubectl create ns keda-system

    - name: Install Helm chart
      run: helm install keda .\keda\ --namespace keda-system
